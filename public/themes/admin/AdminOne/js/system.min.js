/*!
* Design by @systemR
*/

function loadingpage(timeload) {
	$('body').css({"cursor":"progress"});
	$('.data_alert_page').hide();
	$('[line="loadingpage"] .data_alert_page').show();
	$('[line="loadingpage"]').show();
	setTimeout(function(){ $('[line="loadingpage"]').hide().off('click'); $('body').css({"cursor":"default"}); }, timeload);
}

function showLoading() {
    $('body').css({ "cursor": "progress" });
    $('.data_alert_page').hide();
    $('[line="loadingpage"] .data_alert_page').show();
    $('[line="loadingpage"]').show();
}

function hideLoading() {
    $('[line="loadingpage"]').hide().off('click');
    $('body').css({ "cursor": "default" });
}

function openSidebar() {
	let sidebar = document.getElementById("sidebar");
	if (sidebar) sidebar.style.width = "75px";

	let bgSidebar = document.getElementById("bg_sidebar");
	if (bgSidebar) bgSidebar.style.width = "75px";

	let btnSidebarMenu = document.getElementById("btnSidebarMenu");
	if (btnSidebarMenu) btnSidebarMenu.style.margin = "5px 0px 0px 75px";

    $('[onclick="openSidebar()"]').attr('onclick', 'closeSidebar()');
    $('[onclick="closeSidebar()"] i').attr('class', 'fa fa-times');
	$('.bg_logo_sidebar').removeClass('bg_logo_sidebar_min');
    $('.bg_logo_sidebar img').attr('src', "/themes/admin/AdminOne/image/public/logo.png");
	$('.list_sidebar').removeClass('list_sidebar_min');
	$('.list_sidebar .fa-users').css({"margin-left":"0px"});
	// $('.page_main').css({"width":"100%","padding":"5px","margin-left":"237px","overflow-x":"hidden","transition":"0.5s"});
}

function closeSidebar() {
	let sidebar = document.getElementById("sidebar");
	if (sidebar) sidebar.style.width = "75px";

	let bgSidebar = document.getElementById("bg_sidebar");
	if (bgSidebar) bgSidebar.style.width = "75px";

	let btnSidebarMenu = document.getElementById("btnSidebarMenu");
	if (btnSidebarMenu) btnSidebarMenu.style.margin = "5px 0px 0px 75px";
    $('[onclick="closeSidebar()"]').attr('onclick', 'openSidebar()');
    $('[onclick="openSidebar()"] i').attr('class', 'fa fa-bars');
	$('.bg_logo_sidebar').addClass('bg_logo_sidebar_min');
	let foto = $('.logo_sidebar').data('foto');
	let imageUrl = foto ? "/themes/admin/AdminOne/image/public/" + foto : "/themes/admin/AdminOne/image/public/icon.png";
	$('.bg_logo_sidebar img').attr('src', imageUrl);
	$('.list_sidebar').addClass('list_sidebar_min');
	$('.list_sidebar .fa-users').css({"margin-left":"-3px"});
	// $('.page_main').css({"width":"100%","padding":"5px","margin-left":"auto","overflow-x":"hidden","transition":"0.5s"});
}

function SaveData(name) {
	$('form[name="'+name+'"]').submit();
}

function OpenFile(nameform,nameInput) {
	$('input[name="'+nameInput+'"]').val('');
	$('input[name="'+nameInput+'"]').click();

	$(document).on('change', 'input[name="'+nameInput+'"]', function (){
		var file = this.files[0];
		var imagefile = file.type;
		var size  =  $('input[name="'+nameInput+'"]')[0].files[0].size;
		var formatimg = ["image/jpeg","image/png","image/jpg"];
		if (this.files && this.files[0]){
			var reader = new FileReader();
			reader.onload = imageIsLoaded;
			reader.readAsDataURL(this.files[0])
		}
		function imageIsLoaded(e){
			loadingpage(20000);
			$('img[srcimg="'+nameInput+'"]').attr('src', e.target.result);
			$('form[name="'+nameform+'"]').submit();
		}
	});
}

function BackPage() {
	window.history.back();
}

function openSearch() {
    if($('input[name="key-search"]').is(":hidden")){
        $('input[name="key-search"]').show().css({"width": "200px","transition":"0.5s"}).focus();
		$('[btn="openSearch"]').removeClass('btn-default').addClass('btn-danger');
		$('[btn="openSearch"] i').removeClass('fa fa-search').addClass('fa fa-times');
    }else{
		$('input[name="key-search"]').css({"width": "0px","transition":"0.5s"});
		setTimeout(function(){ $('input[name="key-search"]').hide(); }, 400);
		$('[btn="openSearch"]').removeClass('btn-danger').addClass('btn-default');
		$('[btn="openSearch"] i').removeClass('fa fa-times').addClass('fa fa-search');
    }
}

function datefilter() {
	var datefilterstart = $('input[name="datefilterstart"]');
	var datefilterstart = new Date(datefilterstart.val());
	var curr_date_datefilterstart = datefilterstart.getDate();
	var curr_month_datefilterstart = datefilterstart.getMonth() + 1;
	if (curr_month_datefilterstart < 10){
		var curr_month_datefilterstart = '0'+curr_month_datefilterstart;
	}
	var curr_year_datefilterstart = datefilterstart.getFullYear();
	var datefilterstart = curr_year_datefilterstart+"-"+curr_month_datefilterstart+"-"+ curr_date_datefilterstart;

	var datefilterend = $('input[name="datefilterend"]');
	var datefilterend = new Date(datefilterend.val());
	var curr_date_datefilterend = datefilterend.getDate();
	var curr_month_datefilterend = datefilterend.getMonth() + 1;
	if (curr_month_datefilterend < 10){
		var curr_month_datefilterend = '0'+curr_month_datefilterend;
	}
	var curr_year_datefilterend = datefilterend.getFullYear();
	var datefilterend = curr_year_datefilterend+"-"+curr_month_datefilterend+"-"+ curr_date_datefilterend;

	if($('input[name="datefilterstart"]').val() != '' && $('input[name="datefilterend"]').val() != ''){
		window.location.href = encodeURIComponent($('input[id="app_load"]').val())+"?page=1&vd="+encodeURIComponent($('input[id="countvd"]').val())+"&keysearch="+encodeURIComponent($('input[name="key-search"]').val())+"&searchdate="+datefilterstart+"sd"+datefilterend;
	}else{
		window.location.reload();
	}
}

function exportdata(namedata) {
	var datefilterstart = $('input[name="datefilterstart"]');
	var datefilterstart = new Date(datefilterstart.val());
	var curr_date_datefilterstart = datefilterstart.getDate();
	var curr_month_datefilterstart = datefilterstart.getMonth() + 1;
	if (curr_month_datefilterstart < 10){
		var curr_month_datefilterstart = '0'+curr_month_datefilterstart;
	}
	var curr_year_datefilterstart = datefilterstart.getFullYear();
	var datefilterstart = curr_year_datefilterstart+"-"+curr_month_datefilterstart+"-"+ curr_date_datefilterstart;

	var datefilterend = $('input[name="datefilterend"]');
	var datefilterend = new Date(datefilterend.val());
	var curr_date_datefilterend = datefilterend.getDate();
	var curr_month_datefilterend = datefilterend.getMonth() + 1;
	if (curr_month_datefilterend < 10){
		var curr_month_datefilterend = '0'+curr_month_datefilterend;
	}
	var curr_year_datefilterend = datefilterend.getFullYear();
	var datefilterend = curr_year_datefilterend+"-"+curr_month_datefilterend+"-"+ curr_date_datefilterend;

	if(datefilterstart == 'NaN-NaN-NaN'){
		searchdate = "";
	}else{
		searchdate = "&searchdate="+datefilterstart+"sd"+datefilterend;
	}
	window.location.href = "export"+namedata+"?page=1&vd="+encodeURIComponent($('input[id="countvd"]').val())+"&keysearch="+encodeURIComponent($('input[name="key-search"]').val())+searchdate;
}

(function($) {
    $.fn.extend({
        iosCheckbox: function() {
            this.destroy = function(){
                $(this).each(function() {
            		$(this).next('.ios-ui-select').remove();
                });
            };
            
            if ($(this).attr('data-ios-checkbox') === 'true') {
                return;
            }
            
            $(this).attr('data-ios-checkbox', 'true');
            
            $(this).each(function() {
                var org_checkbox = $(this);
                var ios_checkbox = jQuery("<div>", {
                    class: 'ios-ui-select'
                }).append(jQuery("<div>", {
                    class: 'inner'
                }));
                if (org_checkbox.is(":checked")) {
                    ios_checkbox.addClass("checked");
                }
                org_checkbox.hide().after(ios_checkbox);
                
                if (org_checkbox.is(":disabled")){
                	 return ios_checkbox.css('opacity','0.6');
                }
                ios_checkbox.click(function() {
                    ios_checkbox.toggleClass("checked");
                    if (ios_checkbox.hasClass("checked")) {
                        org_checkbox.prop('checked', true);
                    } else {
                        org_checkbox.prop('checked', false);
                    }
                	org_checkbox.click();
                });
            });
            return this;
        }
    });
})(jQuery);

$(document).ready(function(){
	let sidebar = document.getElementById("sidebar");
	if (sidebar) sidebar.style.width = "75px";

	let bgSidebar = document.getElementById("bg_sidebar");
	if (bgSidebar) bgSidebar.style.width = "75px";

	let btnSidebarMenu = document.getElementById("btnSidebarMenu");
	if (btnSidebarMenu) btnSidebarMenu.style.margin = "5px 0px 0px 75px";
	
    $('[onclick="closeSidebar()"]').attr('onclick', 'openSidebar()');
    $('[onclick="openSidebar()"] i').attr('class', 'fa fa-bars');
	$('.bg_logo_sidebar').addClass('bg_logo_sidebar_min');
	let foto = $('.bg_logo_sidebar').data('foto');
	let imageUrl = foto ? "/themes/admin/AdminOne/image/public/" + foto : "/themes/admin/AdminOne/image/public/icon.png";
	$('.bg_logo_sidebar img').attr('src', imageUrl);
	$('.list_sidebar').addClass('list_sidebar_min');	
	$('.list_sidebar .fa-users').css({"margin-left":"-3px"});

    // Setup hover/touch behavior
    setupSidebarHover();
    
    // Handle window resize
    $(window).resize(function() {
        setupSidebarHover();        
    });

	$('.sidebar').mouseover(function(){
		document.getElementById("sidebar").style.width = "280px";
		document.getElementById("bg_sidebar").style.width = "280px";
		document.getElementById("btnSidebarMenu").style.margin = "5px 0px 0px 280px";
		$('[onclick="openSidebar()"]').attr('onclick', 'closeSidebar()');
		$('[onclick="closeSidebar()"] i').attr('class', 'fa fa-times');
		$('.bg_logo_sidebar').removeClass('bg_logo_sidebar_min');
		$('.bg_logo_sidebar img').attr('src', "/themes/admin/AdminOne/image/public/logo.png");
		$('.list_sidebar').removeClass('list_sidebar_min');
		$('.list_sidebar .fa-users').css({"margin-left":"0px"});
	});	

	$('.sidebar').mouseout(function(){
		document.getElementById("sidebar").style.width = "75px";
		document.getElementById("bg_sidebar").style.width = "75px";
		document.getElementById("btnSidebarMenu").style.margin = "5px 0px 0px 75px";
		$('[onclick="closeSidebar()"]').attr('onclick', 'openSidebar()');
		$('[onclick="openSidebar()"] i').attr('class', 'fa fa-bars');
		$('.bg_logo_sidebar').addClass('bg_logo_sidebar_min');
		let foto = $('.bg_logo_sidebar').data('foto');
		let imageUrl = foto ? "/themes/admin/AdminOne/image/public/" + foto : "/themes/admin/AdminOne/image/public/icon.png";
		$('.bg_logo_sidebar img').attr('src', imageUrl);
		$('.list_sidebar').addClass('list_sidebar_min');	
		$('.list_sidebar .fa-users').css({"margin-left":"-3px"});
	});
	
	$('.page_main .container').removeClass('container').addClass('container-fluid');
	$.ajaxSetup({
		headers : {
			'Csrf-Token': $('meta[name="csrf-token"]').attr('content')
		}
	});

	setTimeout(function(){ $('.data_alert_page').hide(); }, 2500);

	$(window).scroll(function(){
		var sc = $(window).scrollTop();
		if (sc < 70) {
			$('[line="hd_action"]').removeClass('fixed');
			$('[line="hd_action"] .hd_page_main').show();
			$('[line="form_action"]').css({"margin-top":"0px"});
		}else{
			$('[line="hd_action"]').addClass('fixed');
			$('[line="hd_action"] .hd_page_main').hide();
			$('[line="form_action"]').css({"margin-top":"70px"});
		}
	});	

	$('a[load="true"]').click(function(){
		if($('a[load="true"]').click){
			loadingpage(2000);
		}
	});

	$('[btn="tgl_view"]').click(function(){
		if($('[btn="tgl_view"]').click){
			var tgl_view = $('[btn="tgl_view"]').attr("line");
			$('input[name="'+tgl_view+'"]').focus();
		}
	});

	$('form[name="form_data"] input').keyup(function(e){if(e.keyCode == 13) {$('button[name="btn_save"]').click();};});

	var keysearch = $('input[name="key-search"]').val();
	if(keysearch != '') {
		$('input[name="key-search"]').show().focus().css({"width": "200px","transition":"0.5s"});
		$('[btn="openSearch"]').removeClass('btn-default').addClass('btn-danger');
		$('[btn="openSearch"] i').removeClass('fa fa-search').addClass('fa fa-times');
	}

	var datefilterstart = $('input[name="datefilterstart"]');
	var datefilterstart = new Date(datefilterstart.val());
	var curr_date_datefilterstart = datefilterstart.getDate();
	var curr_month_datefilterstart = datefilterstart.getMonth() + 1;
	if (curr_month_datefilterstart < 10){
		var curr_month_datefilterstart = '0'+curr_month_datefilterstart;
	}
	var curr_year_datefilterstart = datefilterstart.getFullYear();
	var datefilterstart = curr_year_datefilterstart+"-"+curr_month_datefilterstart+"-"+ curr_date_datefilterstart;

	var datefilterend = $('input[name="datefilterend"]');
	var datefilterend = new Date(datefilterend.val());
	var curr_date_datefilterend = datefilterend.getDate();
	var curr_month_datefilterend = datefilterend.getMonth() + 1;
	if (curr_month_datefilterend < 10){
		var curr_month_datefilterend = '0'+curr_month_datefilterend;
	}
	var curr_year_datefilterend = datefilterend.getFullYear();
	var datefilterend = curr_year_datefilterend+"-"+curr_month_datefilterend+"-"+ curr_date_datefilterend;

	if(datefilterstart == 'NaN-NaN-NaN'){
		searchdate = "";
	}else{
		searchdate = "&searchdate="+datefilterstart+"sd"+datefilterend;
	}

	$('input[id="countvd"]').keyup(function(e){
		if(e.keyCode == 13) {
			loadingpage(2000);
			window.location.href = encodeURIComponent($('input[id="app_load"]').val())+"?page=1&vd="+encodeURIComponent($('input[id="countvd"]').val())+"&keysearch="+encodeURIComponent($('input[name="key-search"]').val())+searchdate;
		}
	});

	$('input[id="countvd"]').change(function(e){
		loadingpage(2000);
		window.location.href = encodeURIComponent($('input[id="app_load"]').val())+"?page=1&vd="+encodeURIComponent($('input[id="countvd"]').val())+"&keysearch="+encodeURIComponent($('input[name="key-search"]').val())+searchdate;
	});

	$('input[name="key-search"]').keyup(function(e){
		if(e.keyCode == 13) {
			loadingpage(2000);
			window.location.href = encodeURIComponent($('input[id="app_load"]').val())+"?page=1&vd=20&keysearch="+encodeURIComponent($('input[name="key-search"]').val())+searchdate;
		}
	});
	
	$('input[name="key-search"]').change(function(e){
		loadingpage(2000);
		window.location.href = encodeURIComponent($('input[id="app_load"]').val())+"?page=1&vd=20&keysearch="+encodeURIComponent($('input[name="key-search"]').val())+searchdate;
	});

	$('input[name="datefilterstart"]').datepicker({
		format: 'dd M yyyy',
		endDate: '0d',
		autoclose : true,
		orientation: "bottom"
    });

	$('input[name="datefilterend"]').datepicker({
		format: 'dd M yyyy',
		endDate: '0d',
		autoclose : true,
		orientation: "bottom"
    });
});


// Tambahkan setelah document ready
function setupSidebarHover() {
    if ('ontouchstart' in window) {
        // Touch devices
        $('.sidebar').on('touchstart', function(e) {
            e.stopPropagation();
            $(this).addClass('sidebar-expanded');
            expandSidebar();
        });
        
        $(document).on('touchstart', function(e) {
            if (!$(e.target).closest('.sidebar').length) {
                $('.sidebar').removeClass('sidebar-expanded');
                collapseSidebar();
            }
        });
    } else {
        // Desktop
        $('.sidebar').hover(
            function() { expandSidebar(); },
            function() { collapseSidebar(); }
        );
    }
}

function expandSidebar() {
    $("#sidebar, #bg_sidebar").css("width", "280px");
    $("#btnSidebarMenu").css("margin", "5px 0px 0px 280px");
    $('[onclick="openSidebar()"]').attr('onclick', 'closeSidebar()')
                                 .find('i').attr('class', 'fa fa-times');
    $('.bg_logo_sidebar').removeClass('bg_logo_sidebar_min')
                        .find('img').attr('src', "/themes/admin/AdminOne/image/public/logo.png");
    $('.list_sidebar').removeClass('list_sidebar_min');
    $('.list_sidebar .fa-users').css("margin-left", "0px");
}

function collapseSidebar() {
    if (!$('.sidebar').hasClass('sidebar-expanded')) {
        $("#sidebar, #bg_sidebar").css("width", "75px");
        $("#btnSidebarMenu").css("margin", "5px 0px 0px 75px");
        $('[onclick="closeSidebar()"]').attr('onclick', 'openSidebar()')
                                     .find('i').attr('class', 'fa fa-bars');
        $('.bg_logo_sidebar').addClass('bg_logo_sidebar_min');
        let foto = $('.bg_logo_sidebar').data('foto');
        let imageUrl = foto ? "/themes/admin/AdminOne/image/public/" + foto : "/themes/admin/AdminOne/image/public/icon.png";
        $('.bg_logo_sidebar img').attr('src', imageUrl);
        $('.list_sidebar').addClass('list_sidebar_min');    
        $('.list_sidebar .fa-users').css("margin-left", "-3px");
    }
}

function openSidebar() {
    $('.sidebar').addClass('sidebar-expanded');
    expandSidebar();
}

function closeSidebar() {
    $('.sidebar').removeClass('sidebar-expanded');
    collapseSidebar();
}

function formatnumber(name,val){
	var fn = $('input[name="'+name+'"]').val();
	var fn = fn.replace(/\b0+/g,"");
	$('input[name="'+name+'"]').val(fn);
	if($('input[name="'+name+'"]').val() == ''){
		$('input[name="'+name+'"]').val(val);
	}
}

function format_angka(nStr)
{
    nStr += '';
    x = nStr.split('.');
    x1 = x[0];
    x2 = x.length > 1 ? '.' + x[1] : '';
    var rgx = /(\d+)(\d{3})/;
    while (rgx.test(x1)) {
        x1 = x1.replace(rgx, '$1' + '.' + '$2');
    }
    return x1 + x2;
}

function titikangka(b){
	var _minus = false;
	if (b<0) _minus = true;
	b = b.toString();
	b=b.replace(".","");
	
	c = "";
	panjang = b.length;
	j = 0;
	for (i = panjang; i > 0; i--){
		 j = j + 1;
		 if (((j % 3) == 1) && (j != 1)){
		   c = b.substr(i-1,1) + "." + c;
		 } else {
		   c = b.substr(i-1,1) + c;
		 }
	}
	if (_minus) c = "-" + c ;
	return c;
}

function numbersonly(ini, e){
	if (e.keyCode>=49){
		if(e.keyCode<=57){
		a = ini.value.toString().replace(".","");
		b = a.replace(/[^\d]/g,"");
		b = (b=="0")?String.fromCharCode(e.keyCode):b + String.fromCharCode(e.keyCode);
		ini.value = titikangka(b);
		return false;
		}
		else if(e.keyCode<=105){
			if(e.keyCode>=96){
				//e.keycode = e.keycode - 47;
				a = ini.value.toString().replace(".","");
				b = a.replace(/[^\d]/g,"");
				b = (b=="0")?String.fromCharCode(e.keyCode-48):b + String.fromCharCode(e.keyCode-48);
				ini.value = titikangka(b);
				//alert(e.keycode);
				return false;
				}
			else {return false;}
		}
		else {
			return false; }
	}else if (e.keyCode==48){
		a = ini.value.replace(".","") + String.fromCharCode(e.keyCode);
		b = a.replace(/[^\d]/g,"");
		if (parseFloat(b)!=0){
			ini.value = titikangka(b);
			return false;
		} else {
			return false;
		}
	}else if (e.keyCode==95){
		a = ini.value.replace(".","") + String.fromCharCode(e.keyCode-48);
		b = a.replace(/[^\d]/g,"");
		if (parseFloat(b)!=0){
			ini.value = titikangka(b);
			return false;
		} else {
			return false;
		}
	}else if (e.keyCode==8 || e.keycode==46){
		a = ini.value.replace(".","");
		b = a.replace(/[^\d]/g,"");
		b = b.substr(0,b.length -1);
		if (titikangka(b)!=""){
			ini.value = titikangka(b);
		} else {
			ini.value = "";
		}
		
		return false;
	} else if (e.keyCode==9){
		return true;
	} else if (e.keyCode==17){
		return true;
	} else {
		//alert (e.keyCode);
		return false;
	}
}

function getkey(e){if (window.event)return window.event.keyCode;else if (e)return e.which;else return null;}
function goodchars(e, goods, field) {
  var key, keychar;
  key = getkey(e);
  if (key == null) return true;

  keychar = String.fromCharCode(key);
  keychar = keychar.toLowerCase();
  goods = goods.toLowerCase();

  // Jika karakter diperbolehkan
  if (goods.indexOf(keychar) != -1) return true;

  // Jika tombol kontrol: null, backspace, tab, escape
  if (key == null || key == 0 || key == 8 || key == 9 || key == 27) return true;

  // Jika tombol Enter (key == 13)
  if (key == 13) {
    // Cek apakah field berada dalam form
    if (!field.form) return true;

    var i;
    for (i = 0; i < field.form.elements.length; i++) {
      if (field == field.form.elements[i]) break;
    }

    i = (i + 1) % field.form.elements.length;
    field.form.elements[i].focus();
    return false;
  }

  // Jika karakter tidak diizinkan
  return false;
}

function getkey(e) {
  if (window.event) return window.event.keyCode;
  else if (e) return e.which;
  else return null;
}

function InputEmail(emailformat) {
	var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
	if(!regex.test(emailformat)) {return false;}else{return true;}
};